<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OpsCopilot</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>OpsCopilot — Enterprise Q&A</h1>

      <section class="card">
        <h2>Ingest Text</h2>
        <textarea id="ingestText" placeholder="Paste document text here..."></textarea>
        <input id="ingestTitle" placeholder="Document Title" />
        <button id="ingestBtn">Ingest</button>
        <div id="ingestOut" class="out"></div>
      </section>

      <section class="card">
        <h2>Ask a Question</h2>
        <input id="q" placeholder="Your question" />
        <button id="askBtn">Ask</button>
        <pre id="ans" class="out"></pre>
        <div id="cites"></div>
      </section>
    </div>

    <script>
      const API = (path) => `http://localhost:8000${path}`;

      document.getElementById('ingestBtn').onclick = async () => {
        const ingestBtn = document.getElementById('ingestBtn');
        ingestBtn.disabled = true; ingestBtn.textContent = 'Uploading...';

        const title = document.getElementById('ingestTitle').value || 'untitled';
        const text = document.getElementById('ingestText').value;
        const res = await fetch(API('/ingest/text'), {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ title, text })
        });
        try {
          const json = await res.json();
          document.getElementById('ingestOut').innerText = JSON.stringify(json, null, 2);
        } catch(e) {
          document.getElementById('ingestOut').innerText = 'Ingest failed: '+e;
        } finally {
          ingestBtn.disabled = false; ingestBtn.textContent = 'Ingest';
        }
      };

      document.getElementById('askBtn').onclick = async () => {
        const askBtn = document.getElementById('askBtn');
        askBtn.disabled = true; askBtn.textContent = 'Thinking...';
        document.getElementById('ans').innerText = '...';

        const q = document.getElementById('q').value;
        const res = await fetch(API('/query'), {
          method: 'POST', headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ query: q, top_k: 4 })
        });
        let data;
        try {
          data = await res.json();
          document.getElementById('ans').innerText = data.answer;
          document.getElementById('cites').innerHTML = (data.citations||[]).map(c => `<div class="cite">[${c.chunk_index}] ${c.title} — ${c.preview}</div>`).join('');
        } catch(e) {
          document.getElementById('ans').innerText = 'Query failed: '+e;
        } finally {
          askBtn.disabled = false; askBtn.textContent = 'Ask';
        }
        document.getElementById('cites').innerHTML = (data.citations||[]).map(c => `<div class="cite">[${c.chunk_index}] ${c.title} — ${c.preview}</div>`).join('');
      };
    </script>
  </body>
</html>
